CC = gcc
NVCC = nvcc
NVCCFLAGS = -arch=sm_35 -O3 -Xcompiler -fopenmp
CFLAGS = -mavx -mavx2 -mfma -msse -msse2 -msse3 -fopenmp

CPU_PHASE1_SRCS = cpu_phase1.c
CPU_PHASE1_OBJS = $(CPU_PHASE1_SRCS:.c=.o)
CPU_PHASE1_TARGET = cpu_phase1

CPU_PHASE2_SRCS = cpu_phase2.c
CPU_PHASE2_OBJS = $(CPU_PHASE2_SRCS:.c=.o)
CPU_PHASE2_TARGET = cpu_phase2

CPU_PHASE3_SRCS = cpu_phase3.c
CPU_PHASE3_OBJS = $(CPU_PHASE3_SRCS:.c=.o)
CPU_PHASE3_TARGET = cpu_phase3

GPU_PHASE1_SRCS = gpu_phase1.cu
GPU_PHASE1_OBJS = $(GPU_PHASE1_SRCS:.cu=.o)
GPU_PHASE1_TARGET = gpu_phase1

GPU_PHASE2_SRCS = gpu_phase2.cu
GPU_PHASE2_OBJS = $(GPU_PHASE2_SRCS:.cu=.o)
GPU_PHASE2_TARGET = gpu_phase2

all: $(CPU_PHASE1_TARGET) $(CPU_PHASE2_TARGET) $(CPU_PHASE3_TARGET) $(GPU_PHASE1_TARGET) $(GPU_PHASE2_TARGET)

$(CPU_PHASE1_TARGET): $(CPU_PHASE1_OBJS)
	$(CC) $(CPU_PHASE1_OBJS) -o $(CPU_PHASE1_TARGET)

$(CPU_PHASE2_TARGET): $(CPU_PHASE2_OBJS)
	$(CC) $(CFLAGS) $(CPU_PHASE2_OBJS) -o $(CPU_PHASE2_TARGET)

$(CPU_PHASE3_TARGET): $(CPU_PHASE3_OBJS)
	$(CC) $(CFLAGS) $(CPU_PHASE3_OBJS) -o $(CPU_PHASE3_TARGET)

$(GPU_PHASE1_TARGET): $(GPU_PHASE1_OBJS)
	$(NVCC) $(NVCCFLAGS) $(GPU_PHASE1_OBJS) -o $(GPU_PHASE1_TARGET)

$(GPU_PHASE2_TARGET): $(GPU_PHASE2_OBJS)
	$(NVCC) $(NVCCFLAGS) $(GPU_PHASE2_OBJS) -o $(GPU_PHASE2_TARGET)

# 依赖关系
$(CPU_PHASE1_OBJS): $(CPU_PHASE1_SRCS)
	$(CC) -c $(CPU_PHASE1_SRCS)

$(CPU_PHASE2_OBJS): $(CPU_PHASE2_SRCS)
	$(CC) -c $(CPU_PHASE2_SRCS)

$(CPU_PHASE3_OBJS): $(CPU_PHASE3_SRCS)
	$(CC) -c $(CPU_PHASE3_SRCS)

$(GPU_PHASE1_OBJS): $(GPU_PHASE1_SRCS)
	$(NVCC) $(NVCCFLAGS) -c $(GPU_PHASE1_SRCS)

$(GPU_PHASE2_OBJS): $(GPU_PHASE2_SRCS)
	$(NVCC) $(NVCCFLAGS) -c $(GPU_PHASE2_SRCS)

clean:
	rm -f $(CPU_PHASE1_OBJS) $(CPU_PHASE1_TARGET) $(CPU_PHASE2_OBJS) $(CPU_PHASE2_TARGET) $(CPU_PHASE3_OBJS) $(CPU_PHASE3_TARGET) $(GPU_PHASE1_OBJS) $(GPU_PHASE1_TARGET) $(GPU_PHASE2_OBJS) $(GPU_PHASE2_TARGET)